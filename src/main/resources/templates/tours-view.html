<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ro">
<head>
    <meta charset="UTF-8">
    <title>Travel Agency - Tururi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
    <h1 class="text-center mb-4">Tururi Disponibile</h1>

    <!-- Mesaje succes / eroare -->
    <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
    <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

    <!-- Formular Adaugă Tur (trimite id-urile locațiilor ca parametri) -->
    <div class="card mb-5">
        <div class="card-header bg-primary text-white">Adaugă un Tur Nou</div>
        <div class="card-body">
            <form th:action="@{/tours-view/add}" method="post">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Plecare de la (locație)</label>
                        <select name="whereFromId" class="form-select" required>
                            <option value="" disabled selected>Selectează</option>
                            <option th:each="loc : ${locations}" th:value="${loc.id}"
                                    th:text="${loc.city + ' - ' + loc.country}"></option>
                        </select>
                        <div class="form-text">Locul de unde pornește turul.</div>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label">Destinație (locație)</label>
                        <select name="whereToId" class="form-select" required>
                            <option value="" disabled selected>Selectează</option>
                            <option th:each="loc : ${locations}" th:value="${loc.id}"
                                    th:text="${loc.city + ' - ' + loc.country}"></option>
                        </select>
                        <div class="form-text">Locația unde ajunge turul.</div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Data plecare</label>
                        <input type="date" name="departureDate" class="form-control" required>
                        <div class="form-text">Data când pornește turul (YYYY-MM-DD).</div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Data retur</label>
                        <input type="date" name="dateOfReturn" class="form-control" required>
                        <div class="form-text">Data când se termină turul (YYYY-MM-DD).</div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Durata (zile)</label>
                        <input type="number" name="numberOfDay" class="form-control" min="1" required>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Preț adulți (€)</label>
                        <input type="number" step="0.01" name="priceForAdults" class="form-control" min="0" required>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Preț copii (€)</label>
                        <input type="number" step="0.01" name="priceForChildren" class="form-control" min="0" required>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Locuri adulți</label>
                        <input type="number" name="numberOfAdults" class="form-control" min="0" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Locuri copii</label>
                        <input type="number" name="numberOfChildren" class="form-control" min="0" required>
                    </div>
                </div>

                <button type="submit" class="btn btn-success w-100">Adaugă Tur</button>
            </form>
        </div>
    </div>

    <!-- Lista Tururi și formular Cumpară Tur -->
    <div class="row" th:each="tour : ${tours}">
        <div class="col-md-4 mb-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="card-title" th:text="${tour.whereFrom.city} + ' → ' + ${tour.whereTo.city} + ' - ' + ${tour.whereTo.country}">Destinație</h5>

                    <p class="card-text">
                        <strong>De la:</strong> <span th:text="${tour.whereFrom.city} + ', ' + ${tour.whereFrom.country}">--</span><br>
                        <strong>Către:</strong> <span th:text="${tour.whereTo.city} + ', ' + ${tour.whereTo.country}">--</span><br>
                        <strong>Durata:</strong> <span th:text="${tour.numberOfDay}">--</span> zile<br>
                        <strong>Perioadă:</strong> <span th:text="${tour.departureDate}">--</span> → <span th:text="${tour.dateOfReturn}">--</span><br>
                        <strong>Preț adulți:</strong> <span th:text="${tour.priceForAdults}">--</span> €<br>
                        <strong>Preț copii:</strong> <span th:text="${tour.priceForChildren}">--</span> €<br>
                        <strong>Locuri disponibile adulți:</strong> <span th:text="${tour.numberOfAdults}">--</span><br>
                        <strong>Locuri disponibile copii:</strong> <span th:text="${tour.numberOfChildren}">--</span>
                    </p>

                    <form th:action="@{/tours-view/buy}" method="post" class="mt-2">
                        <input type="hidden" name="tourId" th:value="${tour.id}">
                        <div class="mb-2">
                            <input type="text" class="form-control" name="customerName" placeholder="Nume client" required>
                        </div>
                        <div class="mb-2">
                            <input type="number" class="form-control" name="numAdults" placeholder="Nr. adulți" min="1" value="1">
                        </div>
                        <div class="mb-2">
                            <input type="number" class="form-control" name="numChildren" placeholder="Nr. copii" min="0" value="0">
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Cumpără</button>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <a href="/" class="btn btn-secondary mt-4">Înapoi acasă</a>
</div>

</body>
</html>
